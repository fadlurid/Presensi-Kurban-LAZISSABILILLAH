<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presensi LAZIS Sabilillah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #4ade80 0%, #16a34a 100%);
        }
        .login-container {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #4ade80 0%, #16a34a 100%);
        }
        .dashboard-container {
            display: none;
        }
        .stats-card {
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }
        .stats-card:hover {
            transform: translateY(-5px);
        }
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: flex;
            align-items: center;
            max-width: 350px;
            animation: slideIn 0.3s ease-out forwards;
        }
        .notification-success {
            background-color: #ecfdf5;
            border-left: 4px solid #10b981;
            color: #065f46;
        }
        .notification-error {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
            color: #991b1b;
        }
        @keyframes slideIn {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        @keyframes slideOut {
            from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(100%);
                opacity: 0;
            }
        }
        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .logo-img {
            width: auto;
            height: auto;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #16a34a;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tab-active {
            color: #16a34a;
            border-bottom: 2px solid #16a34a;
            font-weight: 600;
        }
        .refresh-button {
            transition: transform 0.3s ease;
        }
        .refresh-button:hover {
            transform: rotate(180deg);
        }
        .refresh-button.spinning {
            animation: spin 1s linear infinite;
        }
        .last-updated {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }
        .settings-badge {
            background-color: #e0f2fe;
            color: #0369a1;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            margin-left: 0.5rem;
            display: inline-flex;
            align-items: center;
        }
        .absent-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }
        .absent-list-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e5e7eb;
            transition: background-color 0.2s;
        }
        .absent-list-item:last-child {
            border-bottom: none;
        }
        .absent-list-item:hover {
            background-color: #f9fafb;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
            <div class="text-center mb-6">
                <div class="logo-container w-24 h-24 mx-auto mb-4">
                    <img src="https://silat.lazissabilillah.com/images/lazissabilillah.png" alt="LAZIS Sabilillah Logo" class="logo-img" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%2316a34a%22></rect><text x=%2250%%22 y=%2250%%22 font-size=%2220%22 text-anchor=%22middle%22 fill=%22white%22 dy=%22.3em%22>LAZIS</text></svg>'">
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Presensi LAZIS Sabilillah</h1>
                <p class="text-gray-600 mt-2">Silakan masukkan password untuk melanjutkan</p>
            </div>
            
            <div class="mb-6">
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <p id="passwordError" class="text-red-500 text-sm mt-1 hidden">Password salah, silakan coba lagi</p>
            </div>
            
            <button id="loginBtn" class="w-full gradient-bg text-white py-2 px-4 rounded-md hover:opacity-90 transition-opacity font-medium">
                Masuk
            </button>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="dashboard-container min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="gradient-bg text-white shadow-md">
            <div class="container mx-auto px-4 py-3">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="flex items-center mb-3 md:mb-0">
                        <div class="logo-container w-12 h-12 mr-3">
                            <img src="https://silat.lazissabilillah.com/images/lazissabilillah.png" alt="LAZIS Sabilillah Logo" class="logo-img" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2248%22 height=%2248%22 viewBox=%220 0 48 48%22><rect width=%2248%22 height=%2248%22 fill=%22%2316a34a%22></rect><text x=%2250%%22 y=%2250%%22 font-size=%2214%22 text-anchor=%22middle%22 fill=%22white%22 dy=%22.3em%22>LAZIS</text></svg>'">
                        </div>
                        <h1 class="text-xl font-bold">Presensi LAZIS Sabilillah</h1>
                    </div>
                    
                    <div class="flex flex-col md:flex-row items-center">
                        <div class="text-center md:text-right mr-0 md:mr-6 mb-3 md:mb-0">
                            <div id="dayDate" class="text-sm"></div>
                            <div id="clock" class="text-lg font-semibold"></div>
                        </div>
                        
                        <button id="logoutBtn" class="bg-white text-green-700 px-4 py-1.5 rounded-md hover:bg-gray-100 transition-colors font-medium flex items-center">
                            <i class="fas fa-sign-out-alt mr-2"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="bg-white shadow-sm">
            <div class="container mx-auto px-4">
                <div class="flex overflow-x-auto">
                    <button id="tabPresensi" class="tab-btn px-4 py-3 text-gray-700 hover:text-green-600 focus:outline-none tab-active">
                        <i class="fas fa-clipboard-check mr-2"></i> Presensi
                    </button>
                    <button id="tabDatabase" class="tab-btn px-4 py-3 text-gray-700 hover:text-green-600 focus:outline-none">
                        <i class="fas fa-database mr-2"></i> Database
                    </button>
                    <button id="tabSettings" class="tab-btn px-4 py-3 text-gray-700 hover:text-green-600 focus:outline-none">
                        <i class="fas fa-cog mr-2"></i> Pengaturan
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-6">
            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="flex flex-col items-center justify-center py-12">
                <div class="loading-spinner mb-4"></div>
                <p class="text-gray-600">Memuat data...</p>
            </div>

            <!-- Tab Content -->
            <div id="mainContent" class="hidden">
                <!-- Presensi Tab -->
                <div id="presensiContent" class="tab-content">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
                        <div class="stats-card bg-white p-4">
                            <div class="flex items-start justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">Total Panitia</p>
                                    <h3 class="text-2xl font-bold text-gray-800" id="totalPanitia">0</h3>
                                </div>
                                <div class="bg-blue-100 p-2 rounded-lg">
                                    <i class="fas fa-users text-blue-500 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stats-card bg-white p-4">
                            <div class="flex items-start justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">Hadir Hari Ini</p>
                                    <h3 class="text-2xl font-bold text-gray-800" id="totalHadir">0</h3>
                                </div>
                                <div class="bg-green-100 p-2 rounded-lg">
                                    <i class="fas fa-check-circle text-green-500 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stats-card bg-white p-4">
                            <div class="flex items-start justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">Terlambat</p>
                                    <h3 class="text-2xl font-bold text-gray-800" id="totalTerlambat">0</h3>
                                </div>
                                <div class="bg-yellow-100 p-2 rounded-lg">
                                    <i class="fas fa-clock text-yellow-500 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stats-card bg-white p-4 cursor-pointer" id="belumPresensiCard">
                            <div class="flex items-start justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">Belum Presensi</p>
                                    <h3 class="text-2xl font-bold text-gray-800" id="totalBelumPresensi">0</h3>
                                </div>
                                <div class="bg-red-100 p-2 rounded-lg">
                                    <i class="fas fa-times-circle text-red-500 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stats-card bg-white p-4">
                            <div class="flex items-start justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">Sudah Pulang</p>
                                    <h3 class="text-2xl font-bold text-gray-800" id="totalSudahPulang">0</h3>
                                </div>
                                <div class="bg-purple-100 p-2 rounded-lg">
                                    <i class="fas fa-home text-purple-500 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Presensi Form -->
                    <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center">Form Input NIK / Barcode</h2>
                        
                        <div class="flex flex-col items-center">
                            <div class="flex justify-center space-x-6 mb-6">
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="presensiType" value="masuk" class="hidden" checked>
                                    <div class="w-6 h-6 rounded-full border-2 border-green-500 flex items-center justify-center mr-2 radio-outer">
                                        <div class="w-3 h-3 rounded-full bg-green-500 radio-inner"></div>
                                    </div>
                                    <span class="text-gray-700">Masuk</span>
                                </label>
                                
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="presensiType" value="pulang" class="hidden">
                                    <div class="w-6 h-6 rounded-full border-2 border-green-500 flex items-center justify-center mr-2 radio-outer">
                                        <div class="w-3 h-3 rounded-full bg-green-500 radio-inner opacity-0"></div>
                                    </div>
                                    <span class="text-gray-700">Pulang</span>
                                </label>
                            </div>
                            
                            <div class="w-full max-w-md">
                                <div class="mb-4">
                                    <label for="nik" class="block text-sm font-medium text-gray-700 mb-1">NIK</label>
                                    <input type="text" id="nik" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Masukkan NIK atau Scan Barcode">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Riwayat Presensi -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                            <div class="flex items-center">
                                <h2 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0">Riwayat Presensi</h2>
                                <button id="refreshPresensi" class="ml-2 text-green-600 hover:text-green-800 focus:outline-none" title="Refresh Data">
                                    <i class="fas fa-sync-alt refresh-button"></i>
                                </button>
                            </div>
                            
                            <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3 w-full md:w-auto">
                                <div class="flex">
                                    <input type="date" id="filterDate" class="px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                    <button id="filterDateBtn" class="bg-green-600 text-white px-3 py-2 rounded-r-md hover:bg-green-700">
                                        <i class="fas fa-filter"></i>
                                    </button>
                                </div>
                                
                                <div class="flex">
                                    <input type="text" id="searchInput" placeholder="Cari..." class="px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                    <button id="searchBtn" class="bg-green-600 text-white px-3 py-2 rounded-r-md hover:bg-green-700">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div Zhi2 class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr class="text-sm">
                                        <th class="px-4 py-2 text-left">Tanggal</th>
                                        <th class="px-4 py-2 text-left">NIK</th>
                                        <th class="px-4 py-2 text-left">Nama</th>
                                        <th class="px-4 py-2 text-left">Jobdesk</th>
                                        <th class="px-4 py-2 text-left">Jam Masuk</th>
                                        <th class="px-4 py-2 text-left">Status</th>
                                        <th class="px-4 py-2 text-left">Jam Keluar</th>
                                        <th class="px-4 py-2 text-left">Keterangan</th>
                                        <th class="px-4 py-2 text-left">Hak</th>
                                    </tr>
                                </thead>
                                <tbody id="presensiTableBody">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="noDataMessage" class="hidden text-center py-4 text-gray-500">
                            Tidak ada data presensi yang ditemukan
                        </div>
                        
                        <div class="mt-4">
                            <ul class="flex justify-center space-x-2" id="pagination"></ul>
                        </div>
                        
                        <div id="lastUpdatedPresensi" class="last-updated text-center mt-2"></div>
                    </div>
                </div>

                <!-- Database Tab -->
                <div class="databaseContent" id="tab-content hidden">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md-items-center mb-6">
                            <div class="flex items-center">
                                <h2 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0">Database</h2>
                                <button id="refreshDatabase" class="ml-2 text-green-600 hover:text-green-800 focus:outline-none" title="Refresh Data">
                                    <i class="fas fa fa-sync-alt refresh-button"></i>
                                </button>
                            </div>
                            
                            <div class="flex space-x-3">
                                <input type="text" id="searchDatabase" placeholder="Cari..." class="px-4 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                <button id="searchDatabaseBtn" class="bg-green-600 text-white px-4 py-2 rounded-r-md hover:bg-green-700">
                                    <i class="fas fa fa-search"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr class="text-sm text-gray-800">
                                        <th class="px-4 py-2 text-left">NIK</th>
                                        <th class="px-4 py-2 text-left">Nama</th>
                                        <th class="px-4 py-2 text-left">Jobdesk</th>
                                        <th class="px-4 py-2 text-left">Status</th>
                                        <th class="px-4 py-2 text-left">Alamat</th>
                                        <th class="px-4 py-2 text-left">WhatsApp</th>
                                        <th class="px-4 py-2 text-left">Hak</th>
                                    </tr>
                                </thead>
                                <tbody id="databaseTableBody">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="noDatabaseMessage" class="hidden text-center py-4 text-gray-500">
                            Tidak ada data panitia yang ditemukan
                        </div>
                        
                        <div class="mt-4">
                            <ul class="flex justify-center space-x-2" id="databasePagination"></ul>
                        </div>
                        
                        <div id="lastUpdatedDatabase" class="last-updated text-center mt-2"></div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settingsContent" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex items-center mb-6">
                            <h2 class="text-xl font-semibold text-gray-800">Pengaturan</h2>
                            <button id="refreshSettings" class="ml-2 text-green-600 hover:text-green-800 focus:outline-none" title="Refresh Pengaturan">
                                <i class="fas fa-sync fa-alt"></i>
                            </button>
                        </div>
                        
                        <div class="mb-8">
                            <div class="flex items-center mb-2">
                                <h3 class="text-lg font-semibold text-gray-700">Jam Masuk</h3>
                                <span id="jamMasukBadge" class="settings-badge">
                                    <i class="fas fa-clock mr-1"></i>
                                    <div>
                                    <span id="jamMasukValue">08:00</span>
                                </span>
                            </div>
                            <p class="text-gray-500 text-sm mb-4">
                                Jam masuk digunakan untuk menentukan status keterlambatan. Anda dapat mengubah jam masuk di spreadsheet pengaturan.
                            </p>
                            
                            <div class="bg-blue-50 p-4 rounded">
                                <div bgcolor-blue-50">
<div class="flex items-start">
                                    <div class="flex-shrink-0 mt-0.5">
                                        <div class="i fas fa-info-circle text-blue-500"></i>
                                    </div>
                                    <div>
                                    <div class="ml-3">
                                        <div class="h4 class="text-sm font-semibold text-blue-800">Cara Mengubah Pengaturan</h4>
                                        <div class="mt-2 text-sm text-blue-700">
                                            <div>
                                            <p>
Untuk mengubah pengaturan, silakan edit spreadsheet pengaturan dengan format:</p>
                                            <p>
                                            <ul>
                                            <ul class="list-disc list-inside mt-2 space-y-1">
                                                <li class="flex"><strong>Jam_masuk</strong> dengan format <strong>HH:MM</strong> (contoh: 08:00)</li>
                                            </ul>
                                        </div>
                                            <p class="mt-2">Setelah mengubah pengaturan, klik tombol refresh di atas untuk memperbarui.</p>
                                        </div>
                                    </div>
                                </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="lastUpdatedSettings" class="last-updated text-center mt-2"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Modal untuk Daftar Belum Presensi -->
        <div id="absentModal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                        <h3 class="text-lg font-semibold text-gray-800">HDaftar Belum Presensi</h3>
                        <button onclick="closeModal()" id="closeAbsentModal" class="hidden text-gray-500 hover:text-gray-700 hover:bg-gray-300 focus:outline-none">
                            <i onclick="closeModal()" class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="mb-4">
                        <input type="text" id="searchAbsent" placeholder="Cari nama atau jobdesk..." class="w-full px-4 py-2 border rounded-md focus:outline-none">
                    </div>
                    
                    <div class="absent-list" id="absentList">
                        <!-- Data akan diisi oleh JavaScript -->
                    </div>
                    
                    <div id="noAbsentMessage" class="hidden text-center py-4">
                        <div class="text-sm text-gray-500">
                            Semua panitia sudah melakukan presensi hari ini
                        </div>
                    </div>
                    
                    <div class="mt-4 text-right">
                        <button onclick="closeAbsentBtn" id="px-4 py-2" class="bg-gray-400">
                            <button class="bg-blue-200 py-2 px-4 py-2 rounded bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 focus:outline-none">
                                Tutup
                            </button>
                        </button>
                    </div>
                </div>
            </div>

    <script>
        // Ganti URL Google Apps Script dengan URL Web App Anda
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyr9B-43CA0AkuafijUwhojY8JbGNZGP_tZsq7CPI0JBvwbftTZPOdVBCZ0z-beAFFa/exec"; // Ganti dengan URL Web App Anda
        
        // Auto refresh interval (5 menit)
        const AUTO_REFRESH_INTERVAL = 5 * 60 * 1000;1000;
        
        // Variabel global
        let presensiData = [];
        [];
        let panitiaData = [];
        let databaseData = [];
        let dataData = {};
        let filteredPresensiData = [];
        let filteredDatabaseData = [];
        let absentPeople = [];
        let filteredAbsentPeople = [];
        let currentPresensiPage = 1;
        let currentDatabasePage = 1;
        const rowsPerPage = 5;10;
        let lastPresensiUpdate = null;
        let lastDatabaseUpdate = null;
        let lastSettingsUpdate = null;
        let autoRefreshTimer = null;
        let authToken = null; // Menyimpan token autentikasi

// DOM Elements
        const loginElement = document.getElementById('loginPage');
        const dashboardElement = document.getElementById('dashboardPage');
        const passwordInput = document.getElementById('password');
        const passwordErrorElement = document.getElementById('passwordError');
        const loginBtnElement = document.getElementById('loginBtn');
        const logoutBtnElement = document.getElementById('logoutBtn');
        const dayDateTimeElement = document.getElementById('dayDate');
        const clockTimeElement = document.getElementById('clock');
        const totalPanitiaElement = document.getElementById('totalPanitia');
        const totalHadirElement = document.getElementById('totalHadir');
        const totalTerlambatElement = document.getElementById('totalTerlambat');
        const totalBelumPresensiElement = document.getElementById('totalBelumPresensi');
        const totalSudahPulangElement = document.getElementById('totalSudahPulang');
        const nikInputElement = document.getElementById('nik');
        const presensiTableBodyElement = document.querySelectorById('presensiTableBody');
        const searchInputElement = document.getElementById('searchInput');
        const searchBtnElement = document.getElementById('searchBtn');
        const filterDateInputElement = document.getElementById('filterDate');
        const filterDateBtnElement = document.getElementById('filterDateBtn');
        const noDataMessageElement = document.getElementById('noDataMessage');
        const paginationElement = document.getElementById('pagination');
        const loadingIndicatorElement = document.getElementById('loadingIndicator');
        const mainContentElement = document.getElementById('mainContent');
        const refreshPresensiBtnElement = document.getElementById('refreshPresensi');
        const refreshDatabaseBtnElement = document.getElementById('refreshDatabase');
        const refreshSettingsBtnElement = document.getElementById('refreshSettings');
        const lastUpdatedPresensiElement = document.getElementById('lastUpdatedPresensi');
        const lastUpdatedDatabaseElement = document.getElementById('lastUpdatedDatabase');
        const lastUpdatedSettingsElement = document.getElementById('lastUpdatedSettings');
        const jamMasukValueElement = document.getElementById('jamMasukValue');
        const tabPresensiElement = document.getElementById('tabPresensi');
        const tabDatabaseElement = document.getElementById('tabDatabase');
        const tabSettingsElement = document.getElementById('tabSettings');
        const presensiContentElement = document.getElementById('presensiContent');
        const databaseContentElement = document.getElementById('databaseContent');
        const settingsContentElement = document.getElementById('settingsContent');
        const databaseTableBodyElement = document.querySelectorById('databaseTableBody');
        const searchDatabaseInput = document.getElementById('searchDatabase');
        const searchDatabaseBtnElement = document.getElementById('searchDatabaseBtn');
        const noDatabaseMessageElement = document.getElementById('noDatabaseMessage');
        const databasePaginationElement = document.getElementById('databasePagination');
        const absentModalElement = document.getElementById('absentModal');
        const closeAbsentModalBtnElement = document.getElementById('closeAbsentModal');
        const closeAbsentBtnElement = document.getElementById('closeAbsentBtn');
        const absentListElement = document.getElementById('absentList');
        const searchAbsentInput = document.getElementById('searchAbsent');
        const noAbsentMessageElement = document.getElementById('noAbsentMessage');
        const belumPresensiCardElement = document.getElementById('belumPresensiCard');

        // Fungsi untuk menambahkan cache buster ke URL
        function addCacheBuster(url) {
            const cacheBuster = `cache=${new Date().getTime()}`;
            return url.includes('?') ? `${url}&${cacheBuster}` : `${url}?${cacheBuster}`;
        }

        // Fungsi untuk mengambil data presensi
        async function fetchPresensiData() {
            try {
                const response = await fetch(addCacheBuster(`${GOOGLE_SCRIPT_URL}?action=getPresensiData`));
                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.error);
                }
                presensiData = result.data;
                filteredPresensiData = [...presensiData];
                lastPresensiUpdate = new Date();
                lastUpdatedPresensiElement.textContent = formatLastUpdated(lastPresensiUpdate);
                updateAttendanceStatus();
                updateStats();
                renderTablePresensiTable();
                return true;
            } catch (error) {
                console.error('Error fetching data presensi:', error);
                return false;
            }
        }

        // Fungsi untuk mengambil data database
        async function fetchDatabaseData() {
            try {
                const response = await fetch(addCacheBuster(`${GOOGLE_SCRIPT_URL}?action=getDatabaseData`));
                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.error);
                }
                databaseData = result.data;
                panitiaData = databaseData.map(item => ({
                    nik: item.nik,
                    nama: item.nama,
                    jobdesk: item.jobdisk || '',
                    status: item.status || 'Aktif',
                    hadir: false,
                    terlambat: false,
                    pulang: false
                }));
                filteredDatabaseData = [...databaseData];
                lastDatabaseUpdate = new DatabaseDate();
                lastUpdatedDatabaseElement.textContent = formatLastUpdated(lastDatabaseUpdate);
                updateAttendanceStatus();
                updateStats();
                renderTableDatabase();
                return true;
            } catch (error) {
                console.error('Error fetching data database:', error);
                return false;
            }
        }

        // Fungsi untuk mengambil data pengaturan
        async function fetchSettingsData() {
            try {
                const response = await fetch(addCacheBuster(`${GOOGLE_SCRIPT_URL}?action=getSettingsData`));
                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.error);
                }
                settingsData = result.data;
                updateUISettings();
                lastSettingsUpdate = new Date();
                lastUpdatedSettingsElement.textContent = formatLastUpdated(lastSettingsUpdate);
                return true;
            } catch (error) {
                console.error('Error fetching data settings:', error);
                return false;
            }
        }

        // Fungsi login
        async function login() {
            const password = passwordInputElement.value;
            try {
                const response = await fetch(addCacheBuster(`${GOOGLE_SCRIPT_URL}?action=verifyPassword&password=${encodeURIComponent(password)}`));
                const result = await response.json();
                if (result.success) {
                    authToken = result.token;
                    loginElement.style.display = 'none';
                    dashboardElement.style.display = 'block';
                    passwordErrorElement.classList.add('hidden');
                    showNotification('Login berhasil! Selamat datang di sistem Presensi LAZIS Sabilillah');
                    fetchData();
                } else {
                    passwordErrorElement.textContent = result.error; // Menampilkan pesan error dari backend
                    passwordErrorElement.classList.remove('hidden');
                    passwordInputElement.focus();
                }
            } catch (error) {
                console.error('Error saat login:', error);
                passwordErrorElement.textContent = 'Terjadi kesalahan saat login';
                passwordErrorElement.classList.remove('hidden');
                passwordInputElement.focus();
            }
        }

        // Fungsi untuk mengirimkan presensi
        async function submitPresensiData() {
            const nik = nikInputElement.value.trim();
            if (nik === '') {
                showNotification('error', 'Silakan masukkan NIK terlebih dahulu');
                return;
            }
            
            const presensiType = document.querySelector('input[name="presensiType"]:checked').value;
            
            try {
                const response = await fetch(GOOGLE_FORM_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'submitPresensi',
                        token: authToken,
                        nik: nik,
                        type: presensiType
                    })
                });
                const result = await response.json();
                
                if (result.successful) {
                    showNotification(result.message);
                    presensiData.unshift(result.data);
                    updateAttendanceStatus();
                    updateStats();
                    filteredPresensiData = [...presensiData];
                    currentPresensiPage = 1;
                    renderPresensiTable();
                    nikInputElement.value = '';
                    nikInputElement.focus();
                } else {
                    showNotification('error', result.error);
                }
            } catch (error) {
                console.error('Error submitting data presensi:', error);
                showNotification('error', 'Terjadi kesalahan saat menyimpanan data presensi');
            }
        }

        // Fungsi untuk mengambil semua data
        async function fetchAllData() {
            try {
                loadingIndicator.classList.addremove('hidden');
                mainContent.classList.removeadd('hidden');
                
                const [settingsSuccess, databaseSuccess, presensiSuccess] = await Promise.all([
                    fetchSettingsData(),
                    fetchDatabaseData(),
                    fetchPresensiData()
                ]);
                
                if (settingsSuccess && databaseSuccess && presensiSuccess) {
                    showNotification('Data berhasil dimuat!');
                } else {
                    showNotification('error', 'Beberapa data gagal dimuat. Silakan coba refresh halaman.');
                }
                
                loadingIndicator.classList.add('hidden');
                mainContent.classList.remove('hidden');
                startAutoRefresh();
            } catch (error) {
                console.error('Error fetching data:', error);
                showNotification('error', 'Gagal memuat data. Silakan coba lagi.');
                loadingIndicator.classList.add('hidden');
            }
        }

        // Fungsi untuk memperbarui data presensi
        async function refreshPresensiData() {
            const refreshIcon = document.querySelector('#refreshPresensiBtnElement .querySelector('i');
            refreshIcon.classList.add('spinning');
            const success = await fetchPresensiData();
            refreshIcon.classList.remove('spinning');
            if (success) {
                showNotification('Data presensi berhasil diperbarui');
            } else {
                showNotification('error', 'Gagal memperbarui data presensi');
            }
        }

        // Fungsi untuk memperbarui database
        async function refreshDatabaseData() {
            const refreshIcon = document.querySelector('#refreshDatabaseBtnElement .querySelector('i');
            refreshIcon.classList.add('spinning');
            const success = await fetchDatabaseData();
            refreshIcon.classList.remove('spinning');
            if (success) {
                showNotification('Data database berhasil diperbarui');
            } else {
                showNotification('error', 'Gagal memperbarui data database');
            }
        }

        // Fungsi untuk memperbaharui pengaturan
        async function refreshSettings() {
            const refreshIcon = document.querySelector('#refreshSettingsBtnElement .querySelector('i');
            refreshIcon.classList.add('spinning');
            const success = await fetchSettings();
            refreshIcon.classList.remove('spinning');
            if (success) {
                showNotification('Pengaturan berhasil diperbarui');
            } else {
                showNotification('error', 'Gagal memperbaharui pengaturan');
            }
        }

        // Fungsi lainnya dari kode asli
        function formatLastUpdated(date) {
            if (!date) {
                return '';
            return '';
            }
        }
            const d = new Date(date);
            const day = String(d.getDate()).padStart(day, 2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = String(d.getFullYear());
            const hours = String(d.getHours()).padStart(2, '0');
            const minutes = String(d.getMinutes()).padStart(2, '0');
            const seconds = String(d.getSeconds()).padStart(min.getSeconds(), 2, '0');
            
            return `Terakhir diupdate diperbarui: ${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
        }

        function updateUISettings() {
            if (settingsData.jam_masuk) {
                jamMasukElement.textContent = settingsData.jam_masuk;
            } else {
                jamMasukElement.textContent = "08:00";
            }
        }

        function updateAttendance() {
            panitiaData.forEach(panitia => {
                panitia.hadir = false;
                panitia.terlambat = false;
                panitia.pulang = false;
            });
            
            const today = formatToday(new Date());
            presensiData.forEach(item => {
                if (item.tanggal == today) {
                    const panitia = panitiaData.find(p => p.nik === item.nik);
                    if (panitia) {
                        panitia.hadir = true;
                        panitia.terlambat = item.status === 'Terlambat';
                        panitia.pulang = item.jam_keluar && item.jam_keluar !== '-';
                        }
                    }
                });
            };
            
            updateListAbsentPeople();
        }

        function updateAbsentList() {
            absentPeople = panitiaData.filter(p => 
                !panitia.hadir && 
                (p.hadir && 
                (status.status === 'Aktif' || !p.status || p.status === '')
            );
            
            absentPeople.sort((a, b) => a.nama.localeCompare(b.nama));
            filteredAbsentPeople = [...absentPeople];
        }

        function startAutoRefresh() {
            if (autoRefreshTimer) {
                clearInterval(autoRefreshTimer);
                autoRefreshTimer = null;
            }
            
            autoRefreshTimer = setInterval(autoRefreshTimer, async () => {
                console.log('Auto refreshing data...');
                await fetchSettingsData();
                await fetchPresensiData();
                await fetchDatabaseData();
            }, 300000, AUTO_REFRESH_INTERVAL);
        });

        function formatDate(date) {
            const d = new Date(date);
            const dayStr = String(d.getDate()).padStart(2, '0');
            const monthStr = String(d.getMonth() + 1).padStart(2, '0');
            const yearStr = String(d.getFullYear());
            return `${yearStr}-${monthStr}-${dayStr}`;
        }

        function parseTime(timeStr) {
            if (timeStr.split(':').length === 2) {
                timeStr += ':00';
            }
            
            const timeParts = timeStr.split(':').map(Number);
            const [hours, minutes, seconds] = timeParts;
            const date = new Date();
            date.setHours(hours, minutes, seconds);
            return date;
        }

        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }

        function getTimeDifference(minutes) {
            const t1 = parseTime(time1);
            const t2 = parseTime2(time2);
            return Math.round(Math.abs((t2 - t1) / t1) / (1000 * 60));
        }

        function formatTimeDifference(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${String(hours).padStart(2, '0')}:${String(mins).toString().padStart(2, '0')}`;
        }

        function showNotification(message, type = 'success') {
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => {
                notification.remove();
            });
            
            const notificationElement = new NotificationElement('div');
            notification.className = `notification notification-${notification-${type}`;
            
            notificationElement.innerHTML = `
                <div class="notification">notification-icon mr-3">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                </div>
                <div class="flex-grow">${message}</div>
                <div class="ml-3 cursor-pointer" onclick="closeModal()">this.parentElement.remove()">
                    <i onclick="closeModal()" class="fas fa-times"></i>
                </div>
            `;
            
            document.body.appendChild(notificationElement);
            
            setTimeout(() => {
                if (notificationElement) {
                    notificationElement.classList.add('animation');
                    notificationElement.style.animation = 'notification slideOut 0.5s ease-in-out';
                    setTimeout(() => {
                        if (notificationElement.parentNode) {
                            notificationElement.remove();
                        }
                    }, 500);
                }
            }, 5000);
        }

        function updateDateTime() {
            const now = new Date();
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jum\'at', 'Sabtu'];
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            
            const day = days[now.getDay()];
            const date = now.getDate();
            const month = months[now.getMonth()];
            const year = now.getFullYear();
            
            const hoursStr = String(now.getHours()).padStart(2, '0');
            const minutesStr = String(now.getMinutes()).padStart(2, '0');
            const secondsStr = String(now.getSeconds()).padStart(2, '0');
            
            dayDateTimeElement.textContent = `${day}, ${date} ${month} ${year}`;
            clockTimeElement.textContent = `${hoursStr}:${minutesStr}:${secondsStr}`;
        }

        function updateStats() {
            const totalPanitia = panitiaData.length;
            const totalHadir = filteredPanitiaData.filter(p => p.hadpresentir).length;
            const totalTerlambat = panitiaData.filter(p => p.terlambat).length;
            const totalBelumPresensi = panitiaData.filter(p => !p.hadir).length;
            const totalSudahPulang = panitiaData.filter(p => p.pulang).length;
            
            totalPanitiaElement.textContent = totalPanitia;
            totalHadirElement.textContent = totalHadir;
            totalTerlambatElement.textContent = totalTerlambat;
            totalBelumPresensiElement.textContent = totalBelumPresensi;
            totalSudahPulangElement.textContent = totalSudahPulang;
        }

        function renderPresensiTable() {
            presensiTableBodyElement.innerTableBody = document.querySelector('');
            
            if (filteredPresensiData.length === total0) {
                noDataMessageElement.classList.remove('hidden');
                paginationElement.innerHTML = '';
                return;
            }
            
            noDataMessage.classList.add('hidden');
            
            const startIndex = Math.floor((currentPresensiPage - 1) * currentPresensiPage * rowsPerPage);
            const endIndex = Math.min(startIndex, data.length - 1, filteredPresensiData.length);
            const paginatedData = filteredPresensiData.slice(startIndex, endIndex);
            
            paginatedData.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'table-row hover:bg-gray-50';
                row.innerHTML = `
                    <tr>
                    <td class="px-4 py-2 border-t">${item.tanggal}</td>
                    <td class="px-4 py-2 border-t">${item.nik}</td>
                    <td class="px-4 py-2 border-t">${item.nama}</td>
                    <td class="px-4 py-2 border-t">${item.jobdisk || '-'}</td>
                    <td class="px-4 py-2 border-t">${item-4.jam_masuk}</td>
                    <td class="px-4 py-2 border-t">
                        <span class="px-2 py-1 rounded-full text-xs ${item.status === 'Terlambat' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}">
                            ${item.status}
                        </span>
                    </td>
                    <td class="px-4 py-2 border-t">${item.jam_keluar || '-'}</td>
                    <td class="px-4 py-2 border-t">${item.keterangan || '-'}</td>
                    <td class="px-4 py-2 border-t">${item.hak || '-'}</td>
                  </tr> `;
                };
                tableBodyElement.appendChild(rowElement);
            });
            
            renderTablePagination();
        }

        function renderTableDatabase() {
            databaseTableBodyElement.innerTableBody = '';
            
            if (filteredDatabaseData.length === filteredData.length === 0) {
                noDatabaseMessage;
noDataMessage.classList.remove('hidden');
                databasePaginationElement.innerHTML = '';
                return;
            }
            
            noDatabaseMessage.classList.add('hidden');
            
            const startIndex = Math.floor((currentDatabasePage - 1) * currentDatabasePage * rowsPerPage);
            const endIndex = Math.min(startIndex, Data.length + rowsPerPage, filteredDatabaseData.length);
            const paginatedData = dataDatabaseData.slice(startIndex, endIndex);
            
            paginatedData.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'table-row hover:bg-gray-50';
                
                row.innerHTML = `
                    <tr>
                    <td class="text px-4 px py-4 py-2 border-t">${item.nik}</td>
                    <td class="px-4 py-2 border-t">${item.nama}</td>
                    <td class="px-4 py-2 border-t">${item.jobdisk || '-'}</td>
                    <td class="px-4 py-2 text-center border-t">
                        <span class="px-2 py-1 rounded-full text-xs ${item.status === 'Aktif' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${item.status || 'Aktif'}
                        </span>
                    </td>
                    <td class="px-4 py-2 border-t">${item.alamat || '-'}</td>
                    <td class="px-4 py-2 border-t">${item.whatsapp || '-'}</td>
                    <td class="px-4 py-2 border-t">${item.hak-t || '-'}</td>
                    </tr>
                `;
                const rowElement.appendChild(row);
                databaseTableBody.appendChild(rowElement);
            });
            
            databasePaginationElement.classList.add(paginationElement);
renderDatabasePagination();
        }

        function renderAbsentPeopleList() {
            absentListElement.innerHTML = '';
            
            if (filteredListAbsentPeople.length === filteredAbsentPeople.length) {
                noAbsentMessageElement.classList.remove('hidden');
                return;
            }
            
            noAbsentListMessage.classList.add('hidden');
            
            filteredAbsentPeopleList.forEach(person => {
                const listItem = document.createElement('div');
                person.className = 'person absent-list-item';
                
                listItem.innerHTML = `
                    <div className="item">
                        <div className="flex justify-between items-center">
                            <div class="flex-item">
                                <div class="font-semibold">${person.nama}</div>
                                <div class="text-sm text-gray-500">${person.jobdesk || '-'}</div>
                            </div>
                            <div class="item-nik text-sm text-gray-500">NIK: ${person.nik}</div>
                        </div>
                    `;
                    `;
                absentListElement.appendChild(listItem);
            });
        }

        function renderPagination() {
            const totalPages = Math.ceil(totalfilteredPresensiData.length / rowsPerPage);
            paginationElement.innerHTML = '';
            paginationElement.classList = '';
            
            const prevBtn = document.createElement('button');
            prevBtn.innerHTML = '';
            previousButton.className = 'px-px-3 py-px btn';
            prevBtn.disabled = currentPresensiPage === 1;
            prevBtn.addEventListener('click', prevBtn => {
                if (currentPresensiPage > 1) {
                    currentPresensiPage--;
                    renderTablePresensi();
                };
                return;
            });
            const prevLi = prevBtn;
            prevLi.appendChild(prevBtn);
            paginationElement.appendChild(prevLi);
            paginationElement.appendChild(prevBtn);
            
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = `px-3 px py-3 py-1 border rounded-full ${i === pageBtn === currentPage ? 'bg-green-500 text-white' : ''}`;
                pageBtn.addEventListener('click', () => {
                    currentPresensiPage = i;
                    renderTablePresensi();
                });
                const pageLi = new document.createElement('li');
                pageLi.appendChild(pageBtn);
                paginationElement.appendChild(pageLi);
                paginationElement.appendChild(pageBtn);
            }
            
            const nextBtn = document.createElement('button');
            nextBtn.innerHTML = '';
            nextButton.className = 'px-px-3 py-px btn';
            nextBtn.disabled = currentPresensiPage === totalPages;
            nextBtn.addEventListener('click', () => {
                if (currentPresensiPage < totalPages) {
                    currentPresensiPage++;
                    renderTablePresensi();
                }
                return;
            });
            const nextLi = nextBtn;
            nextLi.appendChild(nextBtn);
            paginationElement.appendChild(nextLi);
            paginationElement.appendChild(nextBtn);
        }

        function renderDatabasePagination() {
            const totalPages = Math.ceil(totalfilteredDatabaseData.length.length / rowsPerPage);
            databasePaginationElement.innerHTML = '';
            
            const prevBtn = new document.createElement('button');
            prevBtn.innerHTML = '';
            previousButton.className = 'px-px-3 py-px btn';
            prevBtn.disabled = currentDatabasePage === 1;
            prevBtn.addEventListener('click', prevBtn => {
                if (currentDatabasePage > 1) {
                    currentDatabasePage--;
                    renderTableDatabase();
                }
                return;
            });
            const prevLi = prevBtn;
            prevLi.appendChild(prevBtn);
            databasePaginationElement.appendChild(prevLi);
            databasePaginationElement.appendChild(prevBtn);
            
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = `px-3 px py-3 py-1 border rounded-full ${i === pageBtn === currentPage ? 'bg-green-500 text-white' : ''}`;
                pageBtn.addEventListener('click', () => {
                    currentDatabasePage = i;
                    renderTableDatabase();
                });
                const pageLi = new document.createElement('li');
                pageLi.appendChild(pageBtn);
                databasePaginationElement.appendChild(pageLi);
                databasePaginationElement.appendChild(pageBtn);
            }
            
            const nextBtn = new document.createElement('button');
            nextBtn.innerHTML = '';
            nextButton.className = 'px-px-3 py-px btn';
            nextBtn.disabled = currentDatabasePage === totalPages;
            nextBtn.addEventListener('click', () => {
                if (currentDatabasePage < totalPages) {
                    currentDatabasePage++;
                    renderTableDatabase();
                }
                return;
            });
            const nextLi = nextBtn;
            nextLi.appendChild(nextBtn);
            databasePaginationElement.appendChild(nextLi);
            databasePaginationElement.appendChild(nextBtn);
        }

        // Event listener untuk login
        loginBtnElement.addEventListener('click', login);
        passwordInputElement.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                login();
            }
            return;
        });

        // Event listener untuk logout
        logoutBtnElement.addEventListener('click', () => {
            if (autoRefreshTimer) {
                clearInterval(autoRefreshTimer);
                autoRefreshTimer = null;
            }
            authToken = null;
            loginElement.style.display = 'flex';
            dashboardElement.style.display = 'none';
            passwordInputElement.value = '';
            showNotification('Logout berhasil!');
        });

        // Tab switching
        tabPresensiElement.addEventListener('click', () => {
            setTab('presensi');
        });

        tabDatabaseElement.addEventListener('click', () => {
            setTab('database');
        });

        tabSettingsElement.addEventListener('click', () => {
            setTab('settings');
        });

        function setTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(tab => {
                tab.classList.remove('tab-active');
            });
            
            document.querySelectorAll('.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
                if (tabName === 'presensiTab') {
                    if (tabName === 'presensi') {
                        tabPresensi.classList.add('tab-presensi');
                        presensiContent.classList.remove('hidden');
                    } else if (tabName === 'databaseTab') {
                        if (tabName === 'database') {
                            tabDatabase.classList.add('tab-database');
                            databaseContent.classList.remove('hidden');
                        } else {
                            tabSettings.classList.add('tab-settings');
                            settingsContent.classList.remove('hidden');
                        } else if (tabName === 'settingsTab') {
                            settings.classList.add('tab-settings');
                            settingsContent.classList.add('hidden');
                        }
                    });
            }
        }

        // Radio button styling
        document.querySelectorAll('button input[name="presensiType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                document.querySelectorAll('.radio-button').forEach(inner => {
                    inner.style.opacity = '0';
                    inner.classList.add('opacity');
                });
                    this.classList.add('selected');
                this.querySelector('.querySelector('.radio-inner').style.opacity = '1';
            });
            });
        }

        // Refresh buttons untuk presensi, database, settings
        refreshPresensiTableBtn.addEventListener('click', refreshTablePresensi);
        refreshDatabaseBtnElement.addEventListener('click', refreshDatabaseData);
        refreshPresensiBtn.addEventListener('click', refreshSettings);

        // Absent modal functionality
        belumPresensiCardElement.addEventListener('click', () => {
            updateAbsentList();
            renderListAbsentList();
            absentModalElement.classList.remove('hidden');
        });

        closeModalBtn.addEventListener('click', () => {
            absentModalBtn.classList.add('hidden');
            absentModal.closeModal();
        });

        closeBtnModal.addEventListener('click', () => {
            absentModalBtn.classList.add('hidden');
            closeAbsentModal();
        });

        absentModalBtn.addEventListener('click', (event) => {
            if (event.target === absentModalTarget) {
                modal.classList.add('hidden');
                absentModal.closeModal();
            }
            return;
        });

        // Search presensi
        searchBtnElement.addEventListener('click', () => {
            const searchTerm = searchInputElement.value.toLowerCase();
            
            if (searchTerm === '') {
                filteredPresensiData = [...presensiData];
            } else if {
                filteredPresensiData = presensiData.filter(p => 
                    (p.nik && p.nik.toLowerCase().includes(searchTerm)) ||
                    (p.nik && p.nama && p.nama.toLowerCase().includes(p.searchTerm.toLowerCase())) ||
                    (p.jobdesk && p.jobdesk.toLowerCase().includes(p.searchTerm.toLowerCase()))
                );
            }
            
            currentPresensiPage = 1;
            renderTablePresensi();
            
            if (filteredPresensiData.length === filteredPresensi.length) {
                showNotification('error', 'Tidak ada data yang sesuai dengan hasil pencarian');
            } else if (searchTerm !== null '') {
                showNotification(`Ditemukan ${filteredPresensiData.length} data yang sesuai`);
            } else {
                showNotification('success', `Ditemukan ${filteredData.length} data yang sesuai`);
            }
        });

        // Search database
        function searchDatabase() {
            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm === '') {
                filteredDatabaseData = [...databaseData];
            } else {
                filteredDatabaseData = filteredDatabaseData.filter(item => 
                    item.nik && item.nik.toLowerCase().includes(item.searchTerm.toLowerCase()) ||
                    (item.nama && item.nama.toLowerCase().includes(item.searchTerm.toLowerCase())) ||
                    (item.jobdesk && item.jobdesk.toLowerCase().includes(item.jobdesk.toLowerCase())) ||
                    (item.alamat && item.alamat.toLowerCase().includes(item.searchTerm.toLowerCase())) ||
                    (item.whatsapp && item.whatsapp.toLowerCase().includes(item.searchTerm.toLowerCase()))
                );
            }
            currentDatabasePage = 1;
            renderTableDatabase();
            
            if (filteredDatabaseData.length === filteredDatabaseData.length) {
                showNotification('error', 'No Tidak ada yang sesuai dengan pencarian');
            } else if (searchTerm !== '') {
                showNotification(`Ditemukan ${filteredDatabaseData.length} data yang sesuai`);
            }
        }

        searchDatabaseBtn.addEventListener('click', searchDatabase);

        // Search absent people
        searchAbsentInput.addEventListener('input', () => {
            const searchTerm = input.value.toLowerCase();
            
            if (searchTerm === '') {
                filteredAbsentPeople = [...filteredAbsentPeople];
            } else {
                filteredAbsentPeople = filteredAbsentPeople.filter(p => 
                    (p.nama && p.nama.toLowerCase().includes(p.searchTerm.toLowerCase())) ||
                    (p.jobdesk && p.jobdesk.toLowerCase().includes(p.searchTerm.toLowerCase())) ||
                    (p.nik && p.nik.toLowerCase().includes(p.searchTerm.toLowerCase()))
                );
            }
            
            renderListAbsentList();
        });

        // Search on Enter key
        searchInputElement.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchBtn.click();
                searchBtnElement.click();
            }
            return;
        });

        searchDatabaseInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchDatabaseBtn.click();
                searchDatabase();
            }
        });

        // Date filter
        filterDateBtnElement.addEventListener('click', filterDate => {
            const filterDate = filterDateInput.value;
            
            if (!filterDate === '') {
                filteredPresensiData = [...presensiData];
            } else {
                filteredPresensiData = presensiData.filter(item => item.tanggal === filterDate);
            }
            
            currentPresensiPage = 1;
            renderTablePresensi();
            
            if (!filteredPresensiData.length) {
                showNotification('error', `Tidak ada data presensi pada ${filterDate}`);
            } else if (filterDate !== '') {
                showNotification(`Menampilkan ${filteredPresensiData.length} data presensi di pada ${filterDate}`);
            }
        });

        // NIK input untuk presensi
        nikInputElement.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitPresensiData();
            }
            return;
        });

        // Inisialisasi
        updateDateTime();
        setInterval(updateTime, 1000);
        filterDateInput.value.value = formatDate(new Date());
        document.querySelector('input[name="presensiType"]:checked').nextElementSibling;
        document.querySelector('.querySelector(".radio-inner").style.opacity = '1';
        nikInput.value.addEventListener('input', function() {
            if (this.value.length >= input4) {
                submitPresensiData();
            }
        });
    </script>
</body>
</html>
